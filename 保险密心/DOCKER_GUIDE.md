# ğŸ³ ä¿é™©å¯†å¿ƒ - Docker æ¨¡å¼æŒ‡å—

## ä¸ºä»€ä¹ˆä½¿ç”¨ Docker æ¨¡å¼ï¼Ÿ

### âœ… Docker çš„ä¼˜åŠ¿

1. **è§£å†³ç»ˆç«¯å¡é¡¿é—®é¢˜**
   - Docker å®¹å™¨åœ¨åå°å®ˆæŠ¤è¿›ç¨‹ä¸­è¿è¡Œ
   - ä¸å ç”¨ IDE çš„ç»ˆç«¯ä¼šè¯
   - Agent çš„ `run_command` åªéœ€å¯åŠ¨å®¹å™¨ï¼Œç«‹å³è¿”å›
   - é¿å…äº† `uvicorn` æˆ– `npm run dev` é•¿æ—¶é—´å ç”¨å‰å°è¿›ç¨‹

2. **ç¯å¢ƒä¸€è‡´æ€§**
   - ä¸ä¾èµ–æœ¬åœ° Python/Node.js ç‰ˆæœ¬
   - ä¾èµ–åŒ…åœ¨å®¹å™¨å†…ç»Ÿä¸€ç®¡ç†
   - å›¢é˜Ÿæˆå‘˜ç¯å¢ƒå®Œå…¨ä¸€è‡´

3. **ç®€åŒ–æ“ä½œ**
   - ä¸€æ¡å‘½ä»¤å¯åŠ¨æ‰€æœ‰æœåŠ¡
   - ä¸éœ€è¦æ‰‹åŠ¨æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ
   - è‡ªåŠ¨å¤„ç†ç«¯å£æ˜ å°„

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### å‰ç½®è¦æ±‚
- å·²å®‰è£… Docker Desktop
- Docker Desktop å·²å¯åŠ¨ï¼ˆçŠ¶æ€æ æ˜¾ç¤º Docker å›¾æ ‡ï¼‰

### å¯åŠ¨æœåŠ¡

```bash
bash /Users/tonyyu/Documents/å¯†å¿ƒ/ä¿é™©å¯†å¿ƒ/docker_start.sh
```

æˆ–ç›´æ¥ä½¿ç”¨ Docker Composeï¼š

```bash
cd /Users/tonyyu/Documents/å¯†å¿ƒ/ä¿é™©å¯†å¿ƒ
docker-compose up -d
```

### åœæ­¢æœåŠ¡

```bash
bash /Users/tonyyu/Documents/å¯†å¿ƒ/ä¿é™©å¯†å¿ƒ/docker_stop.sh
```

æˆ–ç›´æ¥ä½¿ç”¨ï¼š

```bash
docker-compose down
```

---

## ğŸ“Š å¸¸ç”¨å‘½ä»¤

### æŸ¥çœ‹å®¹å™¨çŠ¶æ€
```bash
docker-compose ps
```

### æŸ¥çœ‹æ—¥å¿—
```bash
# æŸ¥çœ‹æ‰€æœ‰æ—¥å¿—
docker-compose logs -f

# åªçœ‹åç«¯æ—¥å¿—
docker-compose logs -f insurance-backend

# åªçœ‹å‰ç«¯æ—¥å¿—
docker-compose logs -f insurance-frontend
```

### é‡å¯æœåŠ¡
```bash
docker-compose restart
```

### é‡æ–°æ„å»ºé•œåƒ
```bash
docker-compose up -d --build
```

### è¿›å…¥å®¹å™¨å†…éƒ¨ï¼ˆè°ƒè¯•ç”¨ï¼‰
```bash
# è¿›å…¥åç«¯å®¹å™¨
docker-compose exec insurance-backend bash

# è¿›å…¥å‰ç«¯å®¹å™¨
docker-compose exec insurance-frontend sh
```

---

## ğŸ”§ é…ç½®è¯´æ˜

### ç«¯å£æ˜ å°„
- åç«¯ï¼š`8001` (ä¸»æœº) â†’ `8001` (å®¹å™¨)
- å‰ç«¯ï¼š`3001` (ä¸»æœº) â†’ `3000` (å®¹å™¨)

### ç¯å¢ƒå˜é‡
åç«¯éœ€è¦åœ¨ `backend/.env` ä¸­é…ç½®ï¼š
```bash
OPENAI_API_KEY=ä½ çš„æ™ºè°±AIå¯†é’¥
OPENAI_API_BASE=https://open.bigmodel.cn/api/paas/v4/
```

### æ•°æ®æŒä¹…åŒ–
- `backend/` ç›®å½•æŒ‚è½½åˆ°å®¹å™¨å†…ï¼Œä»£ç ä¿®æ”¹å®æ—¶ç”Ÿæ•ˆ
- `etl_factory/` æ•°æ®ç›®å½•æŒä¹…åŒ–

---

## ğŸ†š Docker vs æœ¬åœ°è¿è¡Œå¯¹æ¯”

| ç‰¹æ€§ | Docker æ¨¡å¼ | æœ¬åœ°è¿è¡Œ |
|------|------------|----------|
| ç»ˆç«¯å ç”¨ | âœ… ä¸å ç”¨ï¼ˆåå°è¿è¡Œï¼‰ | âŒ å ç”¨å‰å°è¿›ç¨‹ |
| Agent å…¼å®¹æ€§ | âœ… å‘½ä»¤ç«‹å³è¿”å› | âŒ å¯èƒ½å¡é¡¿ |
| ç¯å¢ƒéš”ç¦» | âœ… å®Œå…¨éš”ç¦» | âš ï¸ ä¾èµ–æœ¬åœ°ç¯å¢ƒ |
| å¯åŠ¨é€Ÿåº¦ | âš ï¸ é¦–æ¬¡è¾ƒæ…¢ï¼ˆéœ€æ„å»ºé•œåƒï¼‰ | âœ… å¿«é€Ÿ |
| è°ƒè¯•ä¾¿åˆ©æ€§ | âš ï¸ éœ€è¦è¿›å…¥å®¹å™¨ | âœ… ç›´æ¥è°ƒè¯• |

---

## ğŸš¨ æ•…éšœæ’æŸ¥

### å®¹å™¨å¯åŠ¨å¤±è´¥
```bash
# æŸ¥çœ‹è¯¦ç»†é”™è¯¯
docker-compose logs

# é‡æ–°æ„å»º
docker-compose up -d --build --force-recreate
```

### ç«¯å£è¢«å ç”¨
```bash
# æ¸…ç†æ—§å®¹å™¨
docker-compose down

# æ£€æŸ¥ç«¯å£å ç”¨
lsof -i :8001 -i :3001

# å¦‚æœ‰é Docker è¿›ç¨‹å ç”¨ï¼Œå…ˆæ€æ‰
kill -9 $(lsof -t -i:8001)
kill -9 $(lsof -t -i:3001)
```

### å‰ç«¯æ— æ³•è¿æ¥åç«¯
æ£€æŸ¥ `expert-app/Dockerfile` ä¸­çš„ `NEXT_PUBLIC_API_URL` æ˜¯å¦æ­£ç¡®ã€‚

---

## ğŸ’¡ æœ€ä½³å®è·µ

### å¼€å‘æ—¶æ¨è
- ä½¿ç”¨ Docker æ¨¡å¼é¿å…ç»ˆç«¯ä¼šè¯é—®é¢˜
- ä¿®æ”¹ä»£ç åï¼Œçƒ­é‡è½½è‡ªåŠ¨ç”Ÿæ•ˆï¼ˆå·²é…ç½® volumesï¼‰

### ç”Ÿäº§ç¯å¢ƒ
- ç§»é™¤ `--reload` å‚æ•°
- ä½¿ç”¨ `docker-compose -f docker-compose.prod.yml up -d`

---

## ğŸ“ ä¸ Agent åä½œ

ä½¿ç”¨ Docker æ¨¡å¼åï¼ŒAgent å¯ä»¥é¡ºåˆ©æ‰§è¡Œå¯åŠ¨å‘½ä»¤ï¼š
```bash
docker-compose up -d
```

è¿™æ¡å‘½ä»¤ä¼šç«‹å³è¿”å›ï¼Œä¸ä¼šå¡åœ¨ "Running" çŠ¶æ€ï¼Œå› ä¸ºï¼š
- `-d` å‚æ•°è®©å®¹å™¨åœ¨åå°è¿è¡Œ
- Docker å®ˆæŠ¤è¿›ç¨‹ç®¡ç†å®¹å™¨ç”Ÿå‘½å‘¨æœŸ
- ä¸å ç”¨ç»ˆç«¯ä¼šè¯

---

## âœ… æ¨èå·¥ä½œæµ

1. **é¦–æ¬¡å¯åŠ¨**ï¼š
   ```bash
   bash docker_start.sh
   ```

2. **æ—¥å¸¸å¼€å‘**ï¼š
   - ä»£ç ä¿®æ”¹è‡ªåŠ¨ç”Ÿæ•ˆï¼ˆçƒ­é‡è½½ï¼‰
   - æ— éœ€é‡å¯å®¹å™¨

3. **æŸ¥çœ‹æ—¥å¿—**ï¼š
   ```bash
   docker-compose logs -f
   ```

4. **ç»“æŸå·¥ä½œ**ï¼š
   ```bash
   bash docker_stop.sh
   ```
