# 🛡️ Meseeing (密心) 项目开发进展备份

**日期**：2026-01-28
**当前版本**：v1.2 (Containerized & Robust API)
**状态**：HR 领域基本盘稳固，全栈 Docker 环境打通。

---

## 🏗️ 核心架构演进：从“脆弱”到“强壮”

目前的系统已完成从手动环境向**容器化编排**的蜕变，彻底解决了环境依赖和端口冲突问题。

### 1. 环境冷冻 (Dockerization)

* **后端 (Backend)**：通过 `Dockerfile` 锁定了 Python 3.11 和 FastAPI 环境。
* **前端 (Expert-app)**：通过分阶段构建（Multi-stage build）锁定了 Node 18 环境，消灭了本地 `npm` 版本不一致导致的崩溃。
* **一键编排 (Orchestration)**：引入 `docker-compose.yml`，实现前端、后端、数据卷（Volumes）的一键式启动与生命周期管理。

### 2. 接口契约与稳定性 (API Stability)

* **万能接口垫片 (API Shims)**：后端 `main.py` 实施了多路由兼容策略（如同时支持 `/api/start` 和 `/api/simulation/start`），确保不同版本的前端都能稳定对接。
* **路径强制锚定**：在代码中使用 `Path(__file__).resolve()` 锁定根目录，解决了在不同目录下启动导致的 `processing_log.json` 找不到的问题。

---

## ✅ 已完成的修复与功能增强

### 1. 彻底消灭 422 入库错误

* **原因**：前端之前发送的是单条 `service/category` 结构，而强壮版后端要求 `BatchIngestRequest` 模型。
* **修复**：重写了 `KnowledgeInbox.tsx` 中的 `handleDirectImport`，将数据严格封装为 `items: [{ id, domain }]` 数组格式，实现了与后端批量入库逻辑的完美对接。

### 2. 打通全系统一键启动

* **脚本化**：编写了 `start_all.sh`（或通过原生 `docker-compose -p meseeing up`），实现了前端 (3000) 和后端 (8000) 的自动清理与同步启动。
* **Docker 通信修复**：通过手动挂载 `docker.sock` 解决了 Mac 终端无法连接 Docker Daemon 的连接难题。

---

## 📂 关键文件快照 (Snapshot)

| 文件路径 | 核心职能 |
| --- | --- |
| `backend/main.py` | 具备 API 垫片功能，支持多领域（HR/物业）的万能后端。 |
| `expert-app/app/components/KnowledgeInbox.tsx` | 修复了 422 报错，支持强壮版批量入库逻辑的前端组件。 |
| `docker-compose.yml` | 定义全栈编排，包含持久化挂载 `etl_factory` 的配置。 |
| `expert-app/Dockerfile` | 采用分阶段构建的前端生产环境镜像配置。 |

---

## 🚀 下一步计划 (Next Steps)

1. **一键全选入库**：在 `KnowledgeInbox.tsx` 中增加一个“全部确认入库”按钮，利用现有的 `batch_ingest` 接口实现秒级清洗。
2. **健康检查 (Health Check)**：优化 Compose 配置，确保后端完全就绪后再向前端流量开放。
3. **饱和攻击自动化**：将 HR 领域的“挖掘机”脚本封装进容器定时任务（CronJob），实现知识图谱的自动生长。

---

**备份说明**：此文档记录了系统从“脆弱”向“强壮”转型的关键技术节点。如遇系统混乱，请以此文档中的 Docker 部署方案为准进行回滚。
